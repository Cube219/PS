---
author: Cube219
created: 2024-01-03T00:11:06+09:00
updated: 2024-01-03T00:11:06+09:00
---

[31094번: 전기 전송](https://www.acmicpc.net/problem/31094)

> 출처: [Good Bye, BOJ 2023!](https://www.acmicpc.net/category/detail/4089) E번

# 풀이

* N도 10만, Q도 10만이므로, 쿼리당 처리 속도를 빠르게 해야 한다.
* 하지만 전기가 감쇠하는 식에 나눗셈과 floor함수까지 있어서 쉽지 않다.
* 여기서 나눗셈의 divisor(z)가 정수임에 주목해보자.
    * z가 1이면, floor 함수와 나눗셈 전부 사라지므로 LCA만 구하면 쉽게 비용을 구할 수 있다.
    * z가 2 이상이라면, 나눗셈이기 때문에 비용이 빠르게 감소하게 된다.
* 즉, 쿼리의 경로상에 z가 2 이상인 간선의 개수가 조금만 많아져도 바로 0이 되는 것을 알 수 있다.
    * z가 2인 경우, e가 10^18이라도 약 60번 정도만 나눠도 0이 된다.
* 그러므로, 먼저 쿼리의 경로상에 divisor의 개수가 60개 이상이면 0을 출력해준다.
* 만약 이하라면, 경로에서 z가 2이상인 간선들을 찾아준 뒤, 경로를 타고 가면서 해당 간선들만 별도로 계산해주면 된다.
* 2이상인 간선들 또한 빠르게 찾아줘야 하는데, 이는 LCA를 구할 때와 비슷하게 sparse table을 이용해 구할 수 있다.
    * 출발/도착 지점에서 시작해 가장 가까이 있는 2이상 간선을 찾고, 이를 LCA까지 반복한다.
* 2이상인 간선들의 위치도 구했으면, 경로를 따라 값을 구해주면 된다.
    * 2이상인 간선들을 중간 지점이라 생각하고, 경로를 따라 구하면 된다.
* 구현이 생각보단 쉽지 않음에 주의.
