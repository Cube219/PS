---
author: Cube219
created: 2022-12-02T12:36:52+09:00
updated: 2022-12-02T12:36:52+09:00
---

[13543번: 수열과 쿼리 2](https://www.acmicpc.net/problem/13543)

# 풀이

값 추가/제거/변경은 Treap을 잘 나누고 붙이면 $logN$에 가능하다.

문제는 마지막 쿼리인데, 일단 `k`가 10이므로 노드에 모든 `k`의 경우를 저장하자. 노드가 담당하는 영역만 볼 때, 쿼리4의 값을 `kSum[k]`라 하자. 그러면 노드의 값을 업데이트 할 때 오른쪽에 있는 노드는 (왼쪽 노드의 개수 + 1)만큼 밀어서 합쳐야 한다. 만약 4만큼 밀었다고 생각하면 $a(1)^k + b(2)^k + ...$ => $a(1+4)^k + b(2+4)^k + ...$ 이렇게 된다. 괄호 안 식을 전개해보면 이항식 꼴로 나오고, 이는 이전 `kSum`값을 이용해 구할 수 있다.

주의할 점은 값이 $2^{32}$라서 계산할 때 `long long`에 `unsigned`를 붙여야 overflow가 안 난다.
